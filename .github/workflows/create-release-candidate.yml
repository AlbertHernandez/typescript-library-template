---
name: 'Create release candidate'

on:
  pull_request:

permissions:
  pull-requests: write
  contents: write

jobs:
  create-release-candidate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛬
        uses: actions/checkout@v4
      - name: Create release candidate 🐣
        uses: ./.github/actions/create-release-candidate
        id: release-candidate
        with:
          branch: ${{ github.event.pull_request.head.ref }}
          commit-sha: ${{ github.event.pull_request.head.sha }}
          npm-token: ${{ secrets.NPM_TOKEN }}
      - name: Get current date 🕒
        id: date
        run: |
          utc=$(date -u +"%b %-d, %Y at %-I:%M%p (UTC)")
          echo "utc=$utc" >> "$GITHUB_OUTPUT"
      - name: Get short commit sha 🔑
        uses: benjlevesque/short-sha@v3.0
        id: short-sha
      - uses: marocchino/sticky-pull-request-comment@v2
        env:
          BRANCH: ${{ github.event.pull_request.head.ref }}
          SHA: ${{ github.event.pull_request.head.sha }}
        with:
          header: <release-candidate>
          message: |
            ## ☁️ Release Candidate Preview
            📘 Name | 🔑 Latest Commit | 📦 NPM | 🕒 Updated
            --- | --- | ---| ---
            [typescript-library-template-example](https://github.com/AlbertHernandez/typescript-library-template/tree/${{ env.BRANCH }}) | [${{ steps.short-sha.outputs.sha }}](https://github.com/AlbertHernandez/typescript-library-template/commit/${{ env.SHA }}) | [NPM](https://www.npmjs.com/package/typescript-library-template-example/v/${{ steps.release-candidate.outputs.npm-tag }}) | ${{ steps.date.outputs.utc }}
            ### 💻 Client installation
            To install the release candidate, you can run:
            ```bash
            npm install --save typescript-library-template-example@${{ steps.npm.outputs.tag }}
            ```
